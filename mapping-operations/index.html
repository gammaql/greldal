<!DOCTYPE html><html lang="id"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><link rel="apple-touch-icon" sizes="57x57" href="/greldal/static/favicons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/greldal/static/favicons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/greldal/static/favicons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/greldal/static/favicons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/greldal/static/favicons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/greldal/static/favicons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/greldal/static/favicons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/greldal/static/favicons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/greldal/static/favicons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/greldal/static/favicons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/greldal/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/greldal/static/favicons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/greldal/static/favicons/favicon-16x16.png"/><meta name="msapplication-TileColor" content="#E535AB"/><meta name="msapplication-TileImage" content="/greldal/static/favicons/ms-icon-144x144.png"/><meta name="theme-color" content="#E535AB"/><style data-styled="hFdWyr dRinVF jIsvFx fqzCbS cpbcGU fbiqeh erfeuD jRqOow bQgUGn ZScnH" data-styled-version="4.1.3">
/* sc-component-id: Link__Anchor-sc-1hbrjrd-0 */
.jIsvFx{cursor:pointer;background:black;padding:5px;text-transform:uppercase;border-radius:4px;margin:1.6rem 0;color:white !important;}.fqzCbS{cursor:pointer;}
/* sc-component-id: Link__TrailingIcon-sc-1hbrjrd-1 */
.cpbcGU{margin-right:5px;float:right;}
/* sc-component-id: sc-bdVaJa */
.bQgUGn{margin-right:5px;float:right;margin-left:10px;padding-left:5px;border-left:1px solid white;}
/* sc-component-id: sc-bwzfXH */
.ZScnH{float:left;background:gray;margin:-5px;padding:5px 10px;border-radius:4px 0 0 4px;margin-right:5px;}
/* sc-component-id: sc-htpNat */
.dRinVF{font-size:0.8rem;font-weight:100;color:orange;background:lemonchiffon;padding:4px;border-radius:4px;border:1px solid orange;position:relative;top:-20px;}
/* sc-component-id: Sidebar__FixedSidebarContainer-sc-1bydltt-1 */
.hFdWyr{background:#fff;padding:10px 30px 30px 30px;position:fixed;top:0;left:0;bottom:0;width:300px;overflow-y:auto;overflow-x:auto;border-right:1px solid #bbb;box-shadow:0 0 20px #ccc;} .hFdWyr a,.hFdWyr a:visited{display:block;color:#000;font-weight:700;margin-top:5px;-webkit-text-decoration:none;text-decoration:none;} .hFdWyr h1,.hFdWyr h2,.hFdWyr h3,.hFdWyr h4,.hFdWyr h5,.hFdWyr h6{font-size:0.75rem !important;font-weight:600;}
/* sc-component-id: Sidebar__SectionHeader-sc-1bydltt-2 */
.erfeuD{background:#ddd;padding:5px 10px;text-transform:uppercase;border-radius:4px;color:gray;font-size:0.75rem;margin:1.6rem 0;}
/* sc-component-id: Sidebar__Bolt-sc-1bydltt-3 */
.fbiqeh{margin-right:5px;}
/* sc-component-id: PageLayout__DesktopContentContainer-ct4rbe-6 */
.jRqOow{max-width:700px;margin:40px 100px 50px 400px;} .jRqOow pre{padding:0 !important;} .jRqOow h1{margin:3rem 0;} .jRqOow h2,.jRqOow h3,.jRqOow h4,.jRqOow h5,.jRqOow h6{margin:2rem 0;} .jRqOow p,.jRqOow ol,.jRqOow ul{margin:2rem 0;} .jRqOow pre > code{border-left:4px solid #ddd;display:block;margin:0;padding:5px;} .jRqOow pre{max-width:calc(100% - 40px);overflow-x:auto;border:1px solid #ddd;background:#f8f8f8;} .jRqOow a,.jRqOow a:visited,.jRqOow a:hover,.jRqOow a:active{color:#0261cd;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}</style><meta charSet="utf-8" class="next-head"/><link rel="preload" href="/greldal/_next/static/~zrvxL_use9O2VxGJyrgJ/pages/mapping-operations.js" as="script"/><link rel="preload" href="/greldal/_next/static/~zrvxL_use9O2VxGJyrgJ/pages/_app.js" as="script"/><link rel="preload" href="/greldal/_next/static/runtime/webpack-2a7a0f0e8092aec5eb6f.js" as="script"/><link rel="preload" href="/greldal/_next/static/chunks/commons.f6797a1a24b44de8f81f.js" as="script"/><link rel="preload" href="/greldal/_next/static/runtime/main-2d47b5361aef32ed1165.js" as="script"/><link rel="preload" href="/greldal/_next/static/chunks/styles.ac071f49e3c32efa6076.js" as="script"/><link rel="stylesheet" href="/greldal/_next/static/css/styles.26d0dfba.chunk.css"/></head><body class="custom_class"><div id="__next"><div style="display:none"><div class="Sidebar__SidebarContainer-sc-1bydltt-0 Sidebar__FixedSidebarContainer-sc-1bydltt-1 hFdWyr"><div style="padding-bottom:10px;display:flex;flex-direction:row;cursor:pointer"><img src="/greldal/_next/static/images/81342499647d5509de6dd828ff74969e.png" style="height:50px;width:50px"/><div style="font-weight:600;font-size:2rem;line-height:50px;padding-left:10px;color:#e535ab">GRelDAL<span class="sc-htpNat dRinVF">Beta</span></div></div><a class="Link__Anchor-sc-1hbrjrd-0 jIsvFx"><div class="Link__TrailingIcon-sc-1hbrjrd-1 cpbcGU">⯈</div>API</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Quick Start</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Frequently Asked Questions</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><h1 class="Sidebar__SectionHeader-sc-1bydltt-2 erfeuD">Guides</h1></a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Mapping Data Sources</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Mapping Operations</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Mapping Associations</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Best Practices</a><h1 class="Sidebar__SectionHeader-sc-1bydltt-2 erfeuD">Additional Topics</h1><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Type Safety</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Architecture</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Comparision With Alternatives</a></div><div id="container" class="PageLayout__ContentContainer-ct4rbe-5 PageLayout__DesktopContentContainer-ct4rbe-6 jRqOow"><div><h1 id="mapping-operations"><a href="#mapping-operations" aria-hidden="true"><span class="icon icon-link"></span></a>Mapping Operations</h1><p>GRelDAL supports two types of GraphQL operations: <a href="https://graphql.org/learn/schema/#the-query-and-mutation-types">Queries and Mutations</a>.</p><p>Let us say we have following data source mapping:</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8"><code><span style="color:#333;font-weight:bold">import</span> {mapDataSource, mapFields, types} <span style="color:#333;font-weight:bold">from</span> <span style="color:#d14">&quot;greldal&quot;</span>;

<span style="color:#333;font-weight:bold">const</span> users = mapDataSource({
    <span class="hljs-attr">name</span>: <span style="color:#d14">&quot;User&quot;</span>,
    <span class="hljs-attr">fields</span>: mapFields({
        <span class="hljs-attr">id</span>: {
            <span class="hljs-attr">type</span>: types.number,
            <span class="hljs-attr">to</span>: GraphQLID,
            <span class="hljs-attr">isPrimary</span>: <span style="color:#008080">true</span>,
        },
        <span class="hljs-attr">name</span>: {
            <span class="hljs-attr">type</span>: types.string,
        },
        <span class="hljs-attr">age</span>: {
            <span class="hljs-attr">type</span>: types.integer,
        },
    }),
});</code></pre><p>Now we want to allow users to operate on this data source.
The most convenient way to make this happen is through one of pre-defined operation presets.</p><pre><code class="hljs language-ts" metaString=""><span class="hljs-keyword">import</span> {operationPresets} <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;greldal&quot;</span>;

<span class="hljs-keyword">const</span> schema = mapSchema([
    operationPresets.query.findOneOperation(users)
]);</code></pre><p>A <code>findOne</code> operation allows us to query the users table like this:</p><pre><code>query {
    findOneUser(where: {id: 1}) {
        id
        name
    }
}
</code></pre><p>This will result in an SQL query like:</p><pre><code class="hljs language-sql" metaString=""><span class="hljs-keyword">select</span>
    <span class="hljs-string">`GQL_DAL_users__4`</span>.<span class="hljs-string">`id`</span> <span class="hljs-keyword">as</span> <span class="hljs-string">`GQL_DAL_users__4__id`</span>,
    <span class="hljs-string">`GQL_DAL_users__4`</span>.<span class="hljs-string">`name`</span> <span class="hljs-keyword">as</span> <span class="hljs-string">`GQL_DAL_users__4__name`</span>
<span class="hljs-keyword">from</span> <span class="hljs-string">`users`</span> <span class="hljs-keyword">as</span> <span class="hljs-string">`GQL_DAL_users__4`</span>
<span class="hljs-keyword">where</span> <span class="hljs-string">`GQL_DAL_users__4`</span>.<span class="hljs-string">`id`</span> = <span class="hljs-number">1</span>
<span class="hljs-keyword">limit</span> <span class="hljs-number">1</span></code></pre><p>The preset assumes that the properties of <code>args.where</code> map exactly to field names and we want to fetch results that match all of these values.</p><p>In real world applications we would probably want more flexibility in terms of how the arguments map to queries.</p><p>We will see a couple of approaches for this:</p><h2 id="computed-fields"><a href="#computed-fields" aria-hidden="true"><span class="icon icon-link"></span></a>Computed Fields</h2><p>One approach that we have already seen is by defining computed fields in the data source mapping. GRelDQL can automatically resolve computed fields by mapping them to underlying concrete fields and deriving computed values from them.</p><h2 id="argument-mapping"><a href="#argument-mapping" aria-hidden="true"><span class="icon icon-link"></span></a>Argument Mapping</h2><p>We can also specify the exact arguments we want to expose in our operation and how they map to SQL:</p><pre><code class="hljs language-ts" metaString=""><span class="hljs-keyword">const</span> argMapping = mapArgs({
    fullName: mapFields({
        description: <span class="hljs-string">&quot;Full name of user&quot;</span>,
        <span class="hljs-keyword">type</span>: t.string,
        interceptQuery: <span class="hljs-function">(<span class="hljs-params">queryBuilder: Knex.QueryBuilder, value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> names = value.split(<span class="hljs-string">&quot; &quot;</span>);
            <span class="hljs-keyword">return</span> queryBuilder.where({
                first_name: names[<span class="hljs-number">0</span>],
                last_name: names[<span class="hljs-number">1</span>],
            });
        },
    }),
});

<span class="hljs-keyword">const</span> schema = mapSchema([
    <span class="hljs-keyword">new</span> MappedQueryOperation({
        name: <span class="hljs-string">&quot;findUsersByFullName&quot;</span>,
        rootSource: mappedDataSource,
        singular: <span class="hljs-literal">true</span>,
        args: argMapping,
    }),
]);</code></pre><h2 id="writing-custom-operation-resolvers"><a href="#writing-custom-operation-resolvers" aria-hidden="true"><span class="icon icon-link"></span></a>Writing custom (operation) resolvers</h2><p>This is the most flexible option: A custom resolver is a class that extends from OperationResolver and implements a resolve function that contains the logic of the operation and returns what the API expects.</p><p>More often than not, a resolver will delegate to one or more of other operation resolvers as illustrated below:</p><pre><code class="hljs language-ts" metaString=""><span class="hljs-keyword">import</span> {OperationResolver} <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;greldal&quot;</span>;

<span class="hljs-keyword">const</span> findOperation = operationPresets.query.findOneOperation(users);

<span class="hljs-keyword">class</span> CustomFindOperationResolver <span class="hljs-keyword">extends</span> OperationResolver {
    resolve() {
        <span class="hljs-keyword">return</span> findOperation.resolve({
            <span class="hljs-keyword">this</span>.source,
            {
                department_id: <span class="hljs-keyword">this</span>.args.department
            },
            <span class="hljs-keyword">this</span>.context,
            <span class="hljs-keyword">this</span>.resolveInfoRoot
        });
    }
}

<span class="hljs-keyword">const</span> schema = mapSchema([
    <span class="hljs-keyword">new</span> MappedQueryOperation({
        name: <span class="hljs-string">&#x27;findByDepartmentId&#x27;</span>,
        rootSource: users,
        singular: <span class="hljs-literal">true</span>,
        args: mapArgs({
            department: {
                <span class="hljs-keyword">type</span>: t.string
            }
        }),
        resolver: <span class="hljs-function">(<span class="hljs-params">operation, source, context, args, resolveInfoRoot</span>) =&gt;</span>
            <span class="hljs-keyword">new</span> CustomFindOperationResolver(
                operation,
                source,
                context,
                args,
                resolveInfoRoot
            )
    })
]);</code></pre><p>GRelDAL makes it easy to model complex business logic as a composition of individual operations by leveraging delegation.</p><h2 id="writing-custom-operation-mapping"><a href="#writing-custom-operation-mapping" aria-hidden="true"><span class="icon icon-link"></span></a>Writing custom operation mapping</h2><p>While custom resolvers are flexible enough for most common scenarios, in some cases it may be helpful to write a custom operation mapping which provides a more granular control over how an operation is mapped to the graphql API.</p><p>This approach involves extending the MappedOperation class and providing a custom implementation for the graphQLOperation getter.</p><hr/><a class="Link__Anchor-sc-1hbrjrd-0 jIsvFx" style="display:inline-block;cursor:pointer"><div class="Link__TrailingIcon-sc-1hbrjrd-1 sc-bdVaJa bQgUGn">⯈</div><div class="sc-bwzfXH ZScnH">Next</div> <strong>Mapping Associations</strong></a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/mapping-operations","query":{},"buildId":"~zrvxL_use9O2VxGJyrgJ","nextExport":true}</script><script async="" id="__NEXT_PAGE__/mapping-operations" src="/greldal/_next/static/~zrvxL_use9O2VxGJyrgJ/pages/mapping-operations.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/greldal/_next/static/~zrvxL_use9O2VxGJyrgJ/pages/_app.js"></script><script src="/greldal/_next/static/runtime/webpack-2a7a0f0e8092aec5eb6f.js" async=""></script><script src="/greldal/_next/static/chunks/commons.f6797a1a24b44de8f81f.js" async=""></script><script src="/greldal/_next/static/runtime/main-2d47b5361aef32ed1165.js" async=""></script><script src="/greldal/_next/static/chunks/styles.ac071f49e3c32efa6076.js" async=""></script></body></html>