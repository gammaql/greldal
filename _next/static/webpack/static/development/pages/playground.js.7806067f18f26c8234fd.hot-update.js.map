{"version":3,"file":"static/webpack/static\\development\\pages\\playground.js.7806067f18f26c8234fd.hot-update.js","sources":["webpack:///./pages/playground.js"],"sourcesContent":["import Knex from \"knex\";\r\nimport { useState, useRef } from \"react\";\r\nimport SQLJSClient from \"../utils/SQLJSClient\";\r\nimport * as greldal from \"../../../lib\";\r\nimport * as graphql from \"graphql\";\r\nimport Loadable from \"react-loadable\";\r\nimport SplitPane from \"react-split-pane\";\r\nimport styled from \"styled-components\";\r\nimport logo from \"../assets/logo.png\";\r\n\r\nimport \"../styles/split-pane.css\";\r\n\r\nconst Loading = () => <div>Loading...</div>;\r\n\r\nconst CodeMirror = Loadable.Map({\r\n    loader: {\r\n        ReactCodeMirror: () => import(\"react-codemirror\"),\r\n        resources: () =>\r\n            Promise.all([\r\n                import(\"codemirror/lib/codemirror.css\"),\r\n                import(\"codemirror/mode/javascript/javascript\"),\r\n                import(\"codemirror/theme/monokai.css\"),\r\n                import(\"codemirror/addon/hint/show-hint\"),\r\n                import(\"codemirror/addon/lint/lint\"),\r\n                import(\"codemirror-graphql/hint\"),\r\n                import(\"codemirror-graphql/lint\"),\r\n                import(\"codemirror-graphql/mode\"),\r\n            ]),\r\n    },\r\n    render(loaded, { innerRef, ...props }) {\r\n        let ReactCodeMirror = loaded.ReactCodeMirror.default;\r\n        return <ReactCodeMirror {...props} ref={innerRef} />;\r\n    },\r\n    loading: Loading,\r\n});\r\n\r\nconst AsyncFunction = Object.getPrototypeOf(eval(`(async function __test() {})`)).constructor;\r\n\r\nif (typeof window !== \"undefined\") {\r\n    window.Knex = Knex;\r\n    window.greldal = greldal;\r\n}\r\n\r\nconst defaultCode = `\r\n    greldal.useDatabaseConnector(knex);\r\n\r\n    await knex.schema.createTable(\"customers\", t => {\r\n        t.increments(\"pk\");\r\n        t.string(\"first_name\");\r\n        t.string(\"last_name\");\r\n    });\r\n\r\n    await knex(\"customers\").insert([\r\n        {first_name: \"Harry\", last_name: \"Granger\"},\r\n        {first_name: \"Ron\", last_name: \"Potter\"}\r\n    ]);\r\n\r\n    const fields = greldal.mapFields({\r\n        id: {\r\n            sourceColumn: \"pk\",\r\n            type: greldal.types.number,\r\n            to: {\r\n                input: graphql.GraphQLID,\r\n                output: graphql.GraphQLID,\r\n            },\r\n        },\r\n        firstName: {\r\n            sourceColumn: \"first_name\",\r\n            type: greldal.types.string,\r\n        },\r\n        lastName: {\r\n            sourceColumn: \"last_name\",\r\n            type: greldal.types.string,\r\n        },\r\n    });\r\n\r\n    const users = greldal.mapDataSource({\r\n        name: {\r\n            mapped: \"User\",\r\n            stored: \"customers\",\r\n        },\r\n        fields,\r\n    });\r\n\r\n    const schema = greldal.mapSchema(greldal.operationPresets.defaults(users));\r\n\r\n    return schema;\r\n`;\r\n\r\nconst defaultQuery = `\r\n    query { \r\n        findManyUsers(where: {}) { \r\n            id, \r\n            firstName, \r\n            lastName \r\n        }\r\n    }\r\n`;\r\n\r\nexport default function() {\r\n    const [code, setCode] = useState(defaultCode);\r\n    const [schema, setSchema] = useState(null);\r\n    const [query, setQuery] = useState(defaultQuery);\r\n    const [result, setResult] = useState(\"\");\r\n    const codeEditorRef = useRef(null);\r\n    const gqlEditorRef = useRef(null);\r\n\r\n    const runCode = async () => {\r\n        const knex = Knex({\r\n            client: SQLJSClient,\r\n            debug: true,\r\n            pool: { min: 1, max: 1 },\r\n            acquireConnectionTimeout: 500,\r\n        });\r\n        knex.initialize();\r\n        const run = new AsyncFunction(\"Knex\", \"knex\", \"greldal\", \"graphql\", code);\r\n        try {\r\n            const schema = await run(Knex, knex, greldal, graphql);\r\n            setSchema(schema);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    };\r\n\r\n    const queryAPI = () => {\r\n        if (!schema || !query) return;\r\n        graphql\r\n            .graphql(schema, query)\r\n            .then(res => setResult(res))\r\n            .catch(e => console.error(e));\r\n    };\r\n\r\n    const refreshEditors = () => {\r\n        for (const ref of [codeEditorRef, gqlEditorRef]) {\r\n            if (!ref.current) continue;\r\n            const editor = ref.current.getCodeMirror();\r\n            if (!editor) continue;\r\n            editor.refresh();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <PageContainer>\r\n            <SplitPane split=\"vertical\" minSize={50} defaultSize=\"50%\" onChange={refreshEditors}>\r\n                <div\r\n                    style={{\r\n                        position: \"relative\",\r\n                        width: \"100%\",\r\n                        height: \"100%\",\r\n                        overflow: \"hidden\",\r\n                        display: \"flex\",\r\n                        flexDirection: \"column\",\r\n                    }}\r\n                >\r\n                    <HeaderInfo\r\n                        style={{ display: \"flex\", flexDirection: \"row\", flexGrow: 0, flexShrink: 0 }}\r\n                    >\r\n                        <a href={ROOT_PATH} style={{ display: \"block\", marginRight: \"10px\" }}>\r\n                            <img src={logo} style={{ height: \"50px\", width: \"50px\" }} />\r\n                        </a>\r\n                        <div>\r\n                            GRelDAL Playground is an <strong>experimental</strong> sandboxed environment where you can\r\n                            play around with a GraphQL API powered by GRelDAL and sql.js within your browser without\r\n                            having to install anything.\r\n                        </div>\r\n                        <div\r\n                            style={{\r\n                                flexBasis: \"170px\",\r\n                                flexGrow: \"0\",\r\n                                flexShrink: \"0\",\r\n                            }}\r\n                        >\r\n                            <PrimaryBtn style={{ marginLeft: \"10px\" }} onClick={runCode}>\r\n                                Generate Schema ⇨\r\n                            </PrimaryBtn>\r\n                        </div>\r\n                    </HeaderInfo>\r\n                    <div style={{ position: \"relative\", flexGrow: 2, flexShrink: 1, overflow: \"hidden\" }}>\r\n                        <CodeMirror\r\n                            options={{\r\n                                scrollbarStyle: \"native\",\r\n                                theme: \"monokai\",\r\n                                mode: \"javascript\",\r\n                            }}\r\n                            value={code}\r\n                            onChange={setCode}\r\n                            innerRef={codeEditorRef}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <SplitPane split=\"horizontal\" defaultSize=\"50%\" onChange={refreshEditors}>\r\n                    <div>\r\n                        {schema ? (\r\n                            <>\r\n                                <HeaderInfo>\r\n                                    <PrimaryBtn style={{ float: \"right\", marginLeft: \"10px\" }} onClick={queryAPI}>\r\n                                        Run Query ⇩\r\n                                    </PrimaryBtn>\r\n                                    Query your API using GraphQL\r\n                                </HeaderInfo>\r\n                                <CodeMirror\r\n                                    options={{\r\n                                        theme: \"monokai\",\r\n                                        mode: \"graphql\",\r\n                                        lint: {\r\n                                            schema,\r\n                                        },\r\n                                        hintOptions: {\r\n                                            schema,\r\n                                        },\r\n                                    }}\r\n                                    value={query}\r\n                                    onChange={setQuery}\r\n                                    ref={gqlEditorRef}\r\n                                />\r\n                            </>\r\n                        ) : (\r\n                            <BlankPanel>\r\n                                Once your Schema has been prepared, you will be able to query it from this panel.\r\n                            </BlankPanel>\r\n                        )}\r\n                    </div>\r\n                    <div>{result && <pre>{JSON.stringify(result, null, 2)}</pre>}</div>\r\n                </SplitPane>\r\n            </SplitPane>\r\n        </PageContainer>\r\n    );\r\n}\r\n\r\nconst PageContainer = styled.div`\r\n    position: absolute;\r\n    top: 4px;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n\r\n    .ReactCodeMirror {\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n    }\r\n\r\n    .CodeMirror {\r\n        height: 100%;\r\n        width: 100%;\r\n    }\r\n`;\r\n\r\nconst HeaderInfo = styled.div`\r\n    padding: 10px;\r\n    background: lemonchiffon;\r\n    color: #404040;\r\n    border-bottom: 2px solid #8dd35f;\r\n`;\r\n\r\nconst PrimaryBtn = styled.button`\r\n    background: #5aac31;\r\n    border: 1px solid #abe081;\r\n    border-radius: 4px;\r\n    padding: 10px;\r\n    color: white;\r\n`;\r\n\r\nconst BlankPanel = styled.div`\r\n    background: #ddd;\r\n    color: black;\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n`;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAFA;AAcA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAnBA;AACA;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA8CA;AAUA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAJA;AAMA;AACA;AARA;AAAA;AAAA;AACA;AADA;AAUA;AACA;AAXA;AAAA;AACA;AADA;AAAA;AAAA;AAaA;AACA;AAdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAgBA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AAHA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AADA;AANA;AAUA;AACA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAEA;AAAA;AAAA;AAAA;AAqBA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;;;;A","sourceRoot":""}