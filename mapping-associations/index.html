<!DOCTYPE html><html lang="id"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><link rel="apple-touch-icon" sizes="57x57" href="/greldal/static/favicons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/greldal/static/favicons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/greldal/static/favicons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/greldal/static/favicons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/greldal/static/favicons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/greldal/static/favicons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/greldal/static/favicons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/greldal/static/favicons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/greldal/static/favicons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/greldal/static/favicons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/greldal/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/greldal/static/favicons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/greldal/static/favicons/favicon-16x16.png"/><meta name="msapplication-TileColor" content="#E535AB"/><meta name="msapplication-TileImage" content="/greldal/static/favicons/ms-icon-144x144.png"/><meta name="theme-color" content="#E535AB"/><style data-styled="ehiHiI dRinVF jIsvFx fqzCbS cpbcGU fbiqeh dtTHBq kxQPht bQgUGn ZScnH" data-styled-version="4.2.0">
/* sc-component-id: Link__Anchor-sc-1hbrjrd-0 */
.jIsvFx{cursor:pointer;background:black;padding:5px;text-transform:uppercase;border-radius:4px;margin:1.6rem 0;color:white !important;}.fqzCbS{cursor:pointer;}
/* sc-component-id: Link__TrailingIcon-sc-1hbrjrd-1 */
.cpbcGU{margin-right:5px;float:right;}
/* sc-component-id: sc-bdVaJa */
.bQgUGn{margin-right:5px;float:right;margin-left:10px;padding-left:5px;border-left:1px solid white;}
/* sc-component-id: sc-bwzfXH */
.ZScnH{float:left;background:gray;margin:-5px;padding:5px 10px;border-radius:4px 0 0 4px;margin-right:5px;}
/* sc-component-id: sc-htpNat */
.dRinVF{font-size:0.8rem;font-weight:100;color:orange;background:lemonchiffon;padding:4px;border-radius:4px;border:1px solid orange;position:relative;top:-20px;}
/* sc-component-id: Sidebar__FixedSidebarContainer-sc-1bydltt-1 */
.ehiHiI{background:#fff;padding:10px 30px 30px 30px;position:fixed;top:0;left:0;bottom:0;width:300px;overflow-y:auto;overflow-x:auto;border-right:1px solid #bbb;box-shadow:0 0 20px #ccc;border-top:4px solid #8dd35f;} .ehiHiI a,.ehiHiI a:visited{display:block;color:#000;font-weight:700;margin-top:5px;-webkit-text-decoration:none;text-decoration:none;} .ehiHiI h1,.ehiHiI h2,.ehiHiI h3,.ehiHiI h4,.ehiHiI h5,.ehiHiI h6{font-size:0.75rem !important;font-weight:600;}
/* sc-component-id: Sidebar__SectionHeader-sc-1bydltt-2 */
.dtTHBq{background:#dee9d8;padding:5px 10px;text-transform:uppercase;border-radius:4px;color:gray;font-size:0.75rem;margin:1.6rem 0;}
/* sc-component-id: Sidebar__Bolt-sc-1bydltt-3 */
.fbiqeh{margin-right:5px;}
/* sc-component-id: PageLayout__DesktopContentContainer-ct4rbe-6 */
.kxQPht{max-width:700px;margin:40px 100px 50px 400px;} .kxQPht pre:not(.CodeMirror-line){padding:0 !important;} .kxQPht h1{margin:3rem 0;} .kxQPht h2,.kxQPht h3,.kxQPht h4,.kxQPht h5,.kxQPht h6{margin:2rem 0;} .kxQPht p,.kxQPht ol,.kxQPht ul{margin:2rem 0;} .kxQPht pre:not(.CodeMirror-line) > code{border-left:4px solid #ddd;display:block;margin:0;padding:5px;} .kxQPht pre:not(.CodeMirror-line){max-width:calc(100% - 40px);overflow-x:auto;border:1px solid #ddd;background:#f8f8f8;} .kxQPht a,.kxQPht a:visited,.kxQPht a:hover,.kxQPht a:active{color:#0261cd;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}</style><meta charSet="utf-8" class="next-head"/><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" class="next-head"/><link rel="preload" href="/greldal/_next/static/suUVT1GxdPWvTszvRRJJt/pages/mapping-associations.js" as="script"/><link rel="preload" href="/greldal/_next/static/suUVT1GxdPWvTszvRRJJt/pages/_app.js" as="script"/><link rel="preload" href="/greldal/_next/static/runtime/webpack-1b8c18fc93fcd37a5f35.js" as="script"/><link rel="preload" href="/greldal/_next/static/chunks/commons.b4545264fd9a28185d19.js" as="script"/><link rel="preload" href="/greldal/_next/static/runtime/main-3b66f9db6101882181eb.js" as="script"/><link rel="preload" href="/greldal/_next/static/chunks/styles.c8593acf3e2dbd0d3e25.js" as="script"/><link rel="stylesheet" href="/greldal/_next/static/css/styles.05722033.chunk.css"/></head><body class="custom_class"><div id="__next"><div style="display:none"><div class="Sidebar__SidebarContainer-sc-1bydltt-0 Sidebar__FixedSidebarContainer-sc-1bydltt-1 ehiHiI"><div style="padding-bottom:10px;display:flex;flex-direction:row;cursor:pointer"><img src="/greldal/_next/static/images/6f91cdba06813c05d0b3e558d9f749be.png" style="height:50px;width:50px"/><div style="font-weight:600;font-size:2rem;line-height:50px;padding-left:10px;color:#8dd35f">GRelDAL<span class="sc-htpNat dRinVF">Beta</span></div></div><a class="Link__Anchor-sc-1hbrjrd-0 jIsvFx"><div class="Link__TrailingIcon-sc-1hbrjrd-1 cpbcGU">⯈</div>API</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Quick Start</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Playground (New)</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Frequently Asked Questions</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><h1 class="Sidebar__SectionHeader-sc-1bydltt-2 dtTHBq">Guides</h1></a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Mapping Data Sources</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Mapping Operations</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Mapping Associations</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Best Practices</a><h1 class="Sidebar__SectionHeader-sc-1bydltt-2 dtTHBq">Additional Topics</h1><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Type Safety</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Comparision With Alternatives</a><a class="Link__Anchor-sc-1hbrjrd-0 fqzCbS"><span class="Sidebar__Bolt-sc-1bydltt-3 fbiqeh">⚡</span>Architecture Overview</a></div><div id="container" class="PageLayout__ContentContainer-ct4rbe-5 PageLayout__DesktopContentContainer-ct4rbe-6 kxQPht"><div><h1 id="mapping-queries-over-associations"><a href="#mapping-queries-over-associations" aria-hidden="true"><span class="icon icon-link"></span></a>Mapping Queries over Associations</h1><p>While data sources derived from a single tables are useful in themselves, in larger applications, you&#x27;d likely have data stored across multiple tables. After all, the ability to join tables and enforce constraints on connected tables is what makes relational databases so powerful.</p><p>GRelDAL makes it easy for you to take advantage of advanced features of relational databases, by providing APIs to link data sources through different loading strategies.</p><h3 id="associations-fetched-through-join-queries"><a href="#associations-fetched-through-join-queries" aria-hidden="true"><span class="icon icon-link"></span></a>Associations fetched through join queries</h3><p>We can configure an association between multiple data sources to use a join.</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8"><code><span style="color:#333;font-weight:bold">import</span> {mapDataSource, mapAssociations} <span style="color:#333;font-weight:bold">from</span> <span style="color:#d14">&quot;greldal&quot;</span>;
products = mapDataSource({
    <span class="hljs-attr">name</span>: <span style="color:#d14">&quot;Product&quot;</span>,
    fields,
    <span class="hljs-attr">associations</span>: mapAssociations({
        <span class="hljs-attr">department</span>: {
            <span class="hljs-attr">target</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> departments,
            <span class="hljs-attr">singular</span>: <span style="color:#008080">true</span>,
            <span class="hljs-attr">fetchThrough</span>: [
                {
                    <span class="hljs-attr">join</span>: <span style="color:#d14">&quot;leftOuterJoin&quot;</span>,
                },
            ],
            <span class="hljs-attr">associatorColumns</span>: {
                <span class="hljs-attr">inSource</span>: <span style="color:#d14">&quot;department_id&quot;</span>,
                <span class="hljs-attr">inRelated</span>: <span style="color:#d14">&quot;id&quot;</span>,
            },
        },
    }),
});</code></pre><p>So now, for a query like the following:</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8"><code>query {
    findOneProduct(where: {}) {
        id
        name
        department(where: {}) {
            id
            name
        }
    }
}</code></pre><p>GRelDAL will join the <code>products</code> and <code>departments</code> table on the <code>department_id</code> and <code>id</code> columns.</p><p>You are not limited in how many tables you can join and how the joins should be performed. Even in case of multiple joins or recursive joins, GRelDAL can take care of reverse mapping the fetched data sets into the hierarchical format your client expects.</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8"><code><span style="color:#333;font-weight:bold">import</span> {mapDataSource, mapAssociations} <span style="color:#333;font-weight:bold">from</span> <span style="color:#d14">&quot;greldal&quot;</span>;
tags = mapDataSource({
    <span class="hljs-attr">name</span>: <span style="color:#d14">&quot;Tag&quot;</span>,
    fields,
    <span class="hljs-attr">associations</span>: mapAssociations({
        <span class="hljs-attr">products</span>: {
            <span class="hljs-attr">target</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> products,
            <span class="hljs-attr">singular</span>: <span style="color:#008080">false</span>,
            <span class="hljs-attr">fetchThrough</span>: [
                {
                    <span class="hljs-attr">join</span>: <span class="hljs-function"><span class="hljs-params">joinBuilder</span> =&gt;</span>
                        joinBuilder
                            .leftOuterJoin(<span style="color:#d14">&quot;product_tag_associators&quot;</span>, <span style="color:#d14">&quot;tag_id&quot;</span>, <span style="color:#d14">&quot;=&quot;</span>, <span style="color:#d14">&quot;id&quot;</span>)
                            .leftOuterJoin(<span style="color:#d14">&quot;products&quot;</span>, <span style="color:#d14">&quot;id&quot;</span>, <span style="color:#d14">&quot;=&quot;</span>, <span style="color:#d14">&quot;product_id&quot;</span>),
                },
            ],
        },
    }),
});</code></pre><h3 id="associations-fetched-through-batch-queries"><a href="#associations-fetched-through-batch-queries" aria-hidden="true"><span class="icon icon-link"></span></a>Associations fetched through batch queries:</h3><p>An alternative to joins is to side-load the operations on related data sources.</p><p>Note that in the below scenario, when we are fetching a department and related products, we are always making only two queries - irrespective of the number of departments or the number of products we have or how many of them end up in our result set. Both of these queries are batched, and once again we can fall back on GRelDAL do our reverse mapping for us.</p><pre style="display:block;overflow-x:auto;padding:0.5em;color:#333;background:#f8f8f8"><code><span style="color:#333;font-weight:bold">import</span> {mapDataSource, mapAssociations} <span style="color:#333;font-weight:bold">from</span> <span style="color:#d14">&quot;greldal&quot;</span>;

<span style="color:#333;font-weight:bold">const</span> departments = mapDataSource({
    <span class="hljs-attr">name</span>: <span style="color:#d14">&quot;Department&quot;</span>,
    <span class="hljs-attr">fields</span>: mapFields(fields),
    <span class="hljs-attr">associations</span>: mapAssociations({
        <span class="hljs-attr">products</span>: {
            <span class="hljs-attr">target</span>: <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> products,
            <span class="hljs-attr">singular</span>: <span style="color:#008080">false</span>,
            <span class="hljs-attr">associatorColumns</span>: {
                <span class="hljs-attr">inSource</span>: <span style="color:#d14">&quot;id&quot;</span>,
                <span class="hljs-attr">inRelated</span>: <span style="color:#d14">&quot;department_id&quot;</span>,
            },
            <span class="hljs-attr">fetchThrough</span>: [
                <span style="color:#998;font-style:italic">// We can define multiple side-loading strategies here.</span>
                <span style="color:#998;font-style:italic">//</span>
                <span style="color:#998;font-style:italic">// When user queried by id of department, then we don&#x27;t have to wait for the query on departments to complete</span>
                <span style="color:#998;font-style:italic">// before we start fetching products. In case of preFetch strategy, these queries can happen in parallel, because</span>
                <span style="color:#998;font-style:italic">// given the parameters used to query the data source we can start a parallel query to fetch all the products in</span>
                <span style="color:#998;font-style:italic">// matching departments</span>
                {
                    useIf(operation) {
                        <span style="color:#333;font-weight:bold">return</span> has(operation.args, [<span style="color:#d14">&quot;where&quot;</span>, <span style="color:#d14">&quot;id&quot;</span>]);
                    },
                    preFetch(operation) {
                        <span style="color:#998;font-style:italic">// What preFetch returns is a MappedForeignOperation - which basically points to another operation</span>
                        <span style="color:#998;font-style:italic">// in the related data source (findManyProducts) and the arguments needed to initiate this operation.</span>

                        <span style="color:#333;font-weight:bold">const</span> args: any = operation.args;
                        <span style="color:#333;font-weight:bold">const</span> department_id: string = args.where.id;
                        <span style="color:#333;font-weight:bold">return</span> {
                            <span class="hljs-attr">operation</span>: findManyProducts,
                            <span class="hljs-attr">args</span>: {
                                <span class="hljs-attr">where</span>: {
                                    department_id,
                                },
                            },
                        };
                    },
                },

                <span style="color:#998;font-style:italic">// However if the query parameters to departments are not enough to identify which products we need to fetch,</span>
                <span style="color:#998;font-style:italic">// we can wait for the departments</span>
                {
                    postFetch(_operation, parents) {
                        <span style="color:#998;font-style:italic">// As above, we are instructing GRelDAL to initiate another operation in a foreign data source.</span>
                        <span style="color:#998;font-style:italic">// However, in this case this body will execute once the query on parents has finished. So we have an array of</span>
                        <span style="color:#998;font-style:italic">// fetched parents at our disposal which we can use to identify additional arguments to narrow down the</span>
                        <span style="color:#998;font-style:italic">// subset of products to fetch.</span>
                        <span style="color:#333;font-weight:bold">return</span> {
                            <span class="hljs-attr">operation</span>: findManyProductsByDepartmentIdList,
                            <span class="hljs-attr">args</span>: {
                                <span class="hljs-attr">department_ids</span>: map(parents, <span style="color:#d14">&quot;id&quot;</span>),
                            },
                        };
                    },
                },
            ],
        },
    }),
});</code></pre><a class="Link__Anchor-sc-1hbrjrd-0 jIsvFx" style="display:inline-block;cursor:pointer"><div class="Link__TrailingIcon-sc-1hbrjrd-1 sc-bdVaJa bQgUGn">⯈</div><div class="sc-bwzfXH ZScnH">Next</div> <strong>Best Practices</strong></a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"dataManager":"[]","props":{"pageProps":{}},"page":"/mapping-associations","query":{},"buildId":"suUVT1GxdPWvTszvRRJJt","dynamicBuildId":false,"nextExport":true}</script><script async="" id="__NEXT_PAGE__/mapping-associations" src="/greldal/_next/static/suUVT1GxdPWvTszvRRJJt/pages/mapping-associations.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/greldal/_next/static/suUVT1GxdPWvTszvRRJJt/pages/_app.js"></script><script src="/greldal/_next/static/runtime/webpack-1b8c18fc93fcd37a5f35.js" async=""></script><script src="/greldal/_next/static/chunks/commons.b4545264fd9a28185d19.js" async=""></script><script src="/greldal/_next/static/runtime/main-3b66f9db6101882181eb.js" async=""></script><script src="/greldal/_next/static/chunks/styles.c8593acf3e2dbd0d3e25.js" async=""></script></body></html>